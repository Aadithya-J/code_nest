syntax = "proto3";

package proto;

option go_package = "./;proto";

// The Workspace service definition.
service WorkspaceService {
  // Creates a new project for a user.
  rpc CreateProject(CreateProjectRequest) returns (ProjectResponse);

  // Retrieves a list of all projects for a specific user.
  rpc GetProjects(GetProjectsRequest) returns (GetProjectsResponse);

  // Updates an existing project's details.
  rpc UpdateProject(UpdateProjectRequest) returns (ProjectResponse);

  // Deletes a project by its ID.
  rpc DeleteProject(DeleteProjectRequest) returns (DeleteProjectResponse);

  // Saves or updates a file within a project.
  rpc SaveFile(SaveFileRequest) returns (FileResponse);

  // Retrieves a file's content.
  rpc GetFile(GetFileRequest) returns (FileResponse);

  // Lists all files in a project.
  rpc ListFiles(ListFilesRequest) returns (ListFilesResponse);

  // Deletes a file from a project.
  rpc DeleteFile(DeleteFileRequest) returns (DeleteFileResponse);

  // Renames or moves a file within a project.
  rpc RenameFile(RenameFileRequest) returns (FileResponse);

  // Gets the directory tree structure for a project.
  rpc GetFileTree(GetFileTreeRequest) returns (GetFileTreeResponse);
}

// The Session service definition for managing workspace lifecycles.
service SessionService {
  // Requests the creation of a new workspace session.
  rpc CreateWorkspaceSession(CreateWorkspaceSessionRequest) returns (WorkspaceSessionResponse);

  // Requests the release of an active workspace session.
  rpc ReleaseWorkspaceSession(ReleaseWorkspaceSessionRequest) returns (WorkspaceSessionResponse);

  // Development only: Gets all active sessions for cleanup
  rpc GetAllActiveSessions(GetAllActiveSessionsRequest) returns (GetAllActiveSessionsResponse);
}

// Message Definitions

// Represents a single project.
message Project {
  string id = 1;
  string name = 2;
  string description = 3;
  string userId = 4;
  string createdAt = 5;
  string updatedAt = 6;
}

// Requests & Responses

message CreateProjectRequest {
  string name = 1;
  string description = 2;
  string userId = 3; // Injected by API Gateway after auth.
}

message GetProjectsRequest {
  string userId = 1; // Injected by API Gateway after auth.
}

message GetProjectsResponse {
  repeated Project projects = 1;
}

message UpdateProjectRequest {
  string id = 1; // ID of the project to update.
  string name = 2;
  string description = 3;
  string userId = 4; // Injected by API Gateway for authorization check.
}

message DeleteProjectRequest {
  string id = 1; // ID of the project to delete.
  string userId = 2; // Injected by API Gateway for authorization check.
}

message DeleteProjectResponse {
  bool success = 1;
  string message = 2;
}

// A standard response that returns a single project.
message ProjectResponse {
  Project project = 1;
}

// Represents a single file in a project.
message File {
  string id = 1;
  string projectId = 2;
  string path = 3;
  string content = 4;
  string updatedAt = 5;
}

message SaveFileRequest {
  string projectId = 1;
  string path = 2;
  string content = 3;
  string userId = 4; // For auth check
}

message GetFileRequest {
  string projectId = 1;
  string path = 2;
  string userId = 3; // For auth check
}

message ListFilesRequest {
  string projectId = 1;
  string userId = 2; // For auth check
}

message ListFilesResponse {
  repeated File files = 1;
}

message FileResponse {
  File file = 1;
}

message DeleteFileRequest {
  string projectId = 1;
  string path = 2;
  string userId = 3; // For auth check
}

message DeleteFileResponse {
  bool success = 1;
  string message = 2;
}

message RenameFileRequest {
  string projectId = 1;
  string oldPath = 2;
  string newPath = 3;
  string userId = 4; // For auth check
}

message GetFileTreeRequest {
  string projectId = 1;
  string userId = 2; // For auth check
}

message FileTreeNode {
  string name = 1;
  string path = 2;
  bool isDirectory = 3;
  repeated FileTreeNode children = 4;
}

message GetFileTreeResponse {
  repeated FileTreeNode nodes = 1;
}

// Session-related messages

message CreateWorkspaceSessionRequest {
  string projectId = 1;
  string userId = 2; // Injected by API Gateway
  string gitRepoUrl = 3; // Optional: URL of the git repo to clone
}

message ReleaseWorkspaceSessionRequest {
  string sessionId = 1;
  string projectId = 2; // For authorization and context
  string userId = 3;    // For authorization
}

message WorkspaceSessionResponse {
  string sessionId = 1;
  string status = 2;
  string message = 3;
}

message GetAllActiveSessionsRequest {
  // Empty - returns all active sessions
}

message ActiveSession {
  string sessionId = 1;
  string projectId = 2;
  string userId = 3;
  string status = 4;
}

message GetAllActiveSessionsResponse {
  repeated ActiveSession sessions = 1;
}

